<div class="report-viewer-container">
  <h2>Report Viewer{{ reportId ? ' for ID: ' + reportId : '' }}</h2>

  <div class="layout-toggle">
    <button mat-icon-button (click)="toggleLayout()" [attr.aria-label]="'Toggle ' + (layoutView === 'tabs' ? 'sidebar' : 'tabs') + ' view'">
      <mat-icon>{{ layoutView === 'tabs' ? 'view_sidebar' : 'tab' }}</mat-icon>
    </button>
  </div>

  <div *ngIf="isLoading" class="skeleton-loader">
    <div class="skeleton-header"></div>
    <div class="skeleton-tabs">
      <div class="skeleton-tab"></div>
      <div class="skeleton-tab"></div>
      <div class="skeleton-tab"></div>
      <div class="skeleton-tab"></div>
    </div>
    <div class="skeleton-content"></div>
    <div class="skeleton-content short"></div>
  </div>

  <div *ngIf="error" class="error-message">
    <mat-icon color="warn">error_outline</mat-icon>
    <span>{{ error }}</span>
  </div>

  <div *ngIf="!isLoading && !error && reportData">
    <div *ngIf="layoutView === 'tabs'; else sidebarLayout">
      <mat-tab-group dynamicHeight>
        <mat-tab label="Tokenomics">
          <div class="tab-content">
            <app-tokenomics-section [tokenomicsReport]="reportData.tokenomics"></app-tokenomics-section>
          </div>
        </mat-tab>
        <mat-tab label="Onchain Metrics">
          <div class="tab-content">
            <app-onchain-metrics-section></app-onchain-metrics-section>
          </div>
        </mat-tab>
        <mat-tab label="Code Review">
          <div class="tab-content">
            <app-code-review-section></app-code-review-section>
          </div>
        </mat-tab>
        <mat-tab label="Whitepaper Review">
          <div class="tab-content">
            <app-whitepaper-review-section></app-whitepaper-review-section>
          </div>
        </mat-tab>
        <mat-tab label="Sentiment">
          <div class="tab-content">
            <h3>Sentiment Analysis</h3>
            <pre>{{ reportData.sentiment | json }}</pre>
          </div>
        </mat-tab>
        <mat-tab label="Team">
          <div class="tab-content">
            <h3>Team Information</h3>
            <pre>{{ reportData.team | json }}</pre>
          </div>
        </mat-tab>
        <mat-tab label="Chain Data">
          <div class="tab-content">
            <h3>Blockchain Data</h3>
            <pre>{{ reportData.chainData | json }}</pre>
          </div>
        </mat-tab>
        <mat-tab label="Final Summary">
          <div class="tab-content">
            <app-final-summary [reportData]="reportData"></app-final-summary>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>

    <ng-template #sidebarLayout>
      <div class="sidebar-layout">
        <mat-nav-list class="sidebar-nav">
          <a mat-list-item routerLink="./tokenomics" routerLinkActive="active">Tokenomics</a>
          <a mat-list-item routerLink="./sentiment" routerLinkActive="active">Sentiment</a>
          <a mat-list-item routerLink="./team" routerLinkActive="active">Team</a>
          <a mat-list-item routerLink="./whitepaper-review" routerLinkActive="active">Whitepaper Review</a>
          <a mat-list-item routerLink="./chain-data" routerLinkActive="active">Chain Data</a>
          <a mat-list-item routerLink="./final-summary" routerLinkActive="active">Final Summary</a>
        </mat-nav-list>
        <div class="sidebar-content">
          <router-outlet></router-outlet>
        </div>
      </div>
    </ng-template>
  </div>
</div>
