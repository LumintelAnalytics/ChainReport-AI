<div class="report-viewer-container">
  <h2>Report Viewer{{ reportId ? ' for ID: ' + reportId : '' }}</h2>

  <div class="layout-toggle">
    <button mat-icon-button (click)="toggleLayout()" [attr.aria-label]="'Toggle ' + (layoutView === 'tabs' ? 'sidebar' : 'tabs') + ' view'">
      <mat-icon>{{ layoutView === 'tabs' ? 'view_sidebar' : 'tab' }}</mat-icon>
    </button>
  </div>

  <button mat-raised-button color="primary" class="download-report-button" (click)="downloadReport()" [disabled]="isLoading || !!error || !reportData || isDownloading">
    <mat-icon>download</mat-icon>
    Download Report
  </button>

  <div *ngIf="isLoading" class="skeleton-loader">
    <div class="skeleton-header"></div>
    <div class="skeleton-tabs">
      <div class="skeleton-tab"></div>
      <div class="skeleton-tab"></div>
      <div class="skeleton-tab"></div>
      <div class="skeleton-tab"></div>
    </div>
    <div class="skeleton-content"></div>
    <div class="skeleton-content short"></div>
  </div>

  <div *ngIf="error" class="error-message">
    <mat-icon color="warn">error_outline</mat-icon>
    <span>{{ error }}</span>
  </div>

  <div *ngIf="!isLoading && !error && reportData">
    <div *ngIf="layoutView === 'tabs'; else sidebarLayout">
      <mat-tab-group dynamicHeight>
        <mat-tab label="Tokenomics">
          <div class="tab-content">
            <app-tokenomics-section [tokenomicsReport]="reportData.tokenomics"></app-tokenomics-section>
          </div>
        </mat-tab>
        <mat-tab label="Onchain Metrics">
          <div class="tab-content">
            <app-onchain-metrics-section [onchainMetricsReport]="reportData.onchainMetrics"></app-onchain-metrics-section>
          </div>
        </mat-tab>
        <mat-tab label="Code Review">
          <div class="tab-content">
            <app-code-review-section [codeReviewReport]="reportData.codeReview"></app-code-review-section>
          </div>
        </mat-tab>
        <mat-tab label="Audit Review">
          <div class="tab-content">
            <app-audit-review-section [auditReviewReport]="reportData.auditReview"></app-audit-review-section>
          </div>
        </mat-tab>
        <mat-tab label="Whitepaper Review">
          <div class="tab-content">
            <app-whitepaper-review-section [whitepaperReviewReport]="reportData.whitepaperReview"></app-whitepaper-review-section>
          </div>
        </mat-tab>
        <mat-tab label="Sentiment & Team">
          <div class="tab-content">
            <app-sentiment-team-section [sentimentReport]="reportData.sentiment" [teamReport]="reportData.team"></app-sentiment-team-section>
          </div>
        </mat-tab>
        <mat-tab label="Chain Data">
          <div class="tab-content">
            <h3>Blockchain Data</h3>
            <pre>{{ reportData.chainData | json }}</pre>
          </div>
        </mat-tab>
        <mat-tab label="Final Summary">
          <div class="tab-content">
            <app-final-summary [reportData]="reportData"></app-final-summary>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>

    <ng-template #sidebarLayout>
      <div class="sidebar-layout">
        <mat-nav-list class="sidebar-nav">
          <a mat-list-item routerLink="./tokenomics" routerLinkActive="active">Tokenomics</a>
          <a mat-list-item routerLink="./onchain-metrics" routerLinkActive="active">Onchain Metrics</a>
          <a mat-list-item routerLink="./code-review" routerLinkActive="active">Code Review</a>
          <a mat-list-item routerLink="./audit-review" routerLinkActive="active">Audit Review</a>
          <a mat-list-item routerLink="./whitepaper-review" routerLinkActive="active">Whitepaper Review</a>
          <a mat-list-item routerLink="./sentiment-team" routerLinkActive="active">Sentiment & Team</a>
          <a mat-list-item routerLink="./chain-data" routerLinkActive="active">Chain Data</a>
          <a mat-list-item routerLink="./final-summary" routerLinkActive="active">Final Summary</a>
        </mat-nav-list>
        <div class="sidebar-content">
          <router-outlet></router-outlet>
        </div>
      </div>
    </ng-template>
  </div>
</div>
